<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Controle - Simulador</title>
    
    <style>
        /* --- Configuração Global --- */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
        }

        /* --- Layout Principal (CSS Grid) --- */
        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Duas colunas de tamanho igual */
            grid-template-rows: 50vh 50vh;  /* Duas linhas de 50% da altura da tela */
            gap: 10px;
            padding: 10px;
            box-sizing: border-box; /* Para o padding não estourar a tela */
        }

        .quadrant {
            background-color: #ffffff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column; /* Organiza o conteúdo verticalmente */
        }

        .quadrant h2 {
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        /* --- Caixas de Display (Logs e Output) --- */
        .display-box {
            flex-grow: 1; /* Faz a caixa ocupar o espaço restante */
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: auto; /* Adiciona scroll se o conteúdo for grande */
            padding: 10px;
            font-size: 0.9em;
        }

        /* Estilo "Terminal" para o output do donut */
        .terminal {
            background-color: #000;
            color: #00ff00; /* Verde "fósforo" */
            font-family: 'Courier New', Courier, monospace;
            white-space: pre; /* MUITO IMPORTANTE para ASCII art */
            font-size: 1em;
            line-height: 1.1;
        }

        /* --- Estilos Específicos --- */

        /* Q1: Controles */
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 20px;
            max-width: 300px;
            margin: auto; /* Centraliza a grade de botões */
        }

        .control-buttons button {
            padding: 20px;
            font-size: 1.5em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            background-color: #e0e0e0;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        .control-buttons button:hover {
            background-color: #d0d0d0;
        }

        .control-buttons button:active {
            background-color: #4CAF50;
            color: white;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Posicionamento dos botões (estilo WASD) */
        #btn-w { grid-column: 2; grid-row: 1; }
        #btn-a { grid-column: 1; grid-row: 2; }
        #btn-s { grid-column: 2; grid-row: 2; }
        #btn-d { grid-column: 3; grid-row: 2; }

        /* Q2: Logs */
        #log-display {
            white-space: pre-wrap; /* Quebra a linha dos logs */
        }

        #btn-clear-logs {
            margin-bottom: 10px;
            padding: 8px;
            background-color: #ff6b6b;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #btn-clear-logs:hover {
            background-color: #e05252;
        }
    </style>
    </head>
<body>
    
    <div class="grid-container">
        
        <div id="q1" class="quadrant">
            <h2>Controles</h2>
            <div class="control-buttons">
                <button id="btn-w">W</button>
                <button id="btn-a">A</button>
                <button id="btn-s">S</button>
                <button id="btn-d">D</button>
            </div>
        </div>

        <div id="q2" class="quadrant">
            <h2>Logs ao Vivo</h2>
            <button id="btn-clear-logs">Limpar Logs no Servidor</button>
            <pre id="log-display" class="display-box"></pre>
        </div>

        <div id="q3" class="quadrant">
            <h2>Output (Donut)</h2>
            <pre id="output-display" class="display-box terminal"></pre>
        </div>

        <div id="q4" class="quadrant">
            <h2>Extra</h2>
            </div>
    </div>
    <script>
        // Aguarda o DOM estar pronto para rodar o script
        document.addEventListener("DOMContentLoaded", () => {
            
            // --- 1. Conexão WebSocket ---
            // Mude "localhost:8080" para o endereço do seu servidor C++
            const socket = new WebSocket("ws://localhost:8080");

            socket.onopen = () => {
                updateLog("Conectado ao servidor do simulador!");
            };

            socket.onclose = () => {
                updateLog("Desconectado do servidor. Tentando reconectar...");
                // (Aqui você pode adicionar lógica de reconexão)
            };

            socket.onerror = (error) => {
                updateLog(`Erro no WebSocket: ${error.message}`);
            };

            // --- 2. Recebendo Mensagens do Servidor ---
            // O servidor deve enviar JSON no formato:
            // { "type": "log", "data": "..." }
            // { "type": "frame", "data": "..." }
            socket.onmessage = (event) => {
                try {
                    const msg = JSON.parse(event.data);

                    if (msg.type === "log") {
                        updateLog(msg.data);
                    } else if (msg.type === "frame") {
                        updateOutput(msg.data);
                    }

                } catch (e) {
                    // Se não for JSON, trata como log simples
                    updateLog(`Servidor (raw): ${event.data}`);
                }
            };

            // --- 3. Seleção de Elementos DOM ---
            const btnW = document.getElementById("btn-w");
            const btnA = document.getElementById("btn-a");
            const btnS = document.getElementById("btn-s");
            const btnD = document.getElementById("btn-d");
            const btnClearLogs = document.getElementById("btn-clear-logs");
            const logDisplay = document.getElementById("log-display");
            const outputDisplay = document.getElementById("output-display");

            // --- 4. Funções de Envio ---
            
            // Envia um input de tecla para o servidor
            function sendInput(key) {
                if (socket.readyState === WebSocket.OPEN) {
                    const msg = {
                        type: "input",
                        key: key
                    };
                    socket.send(JSON.stringify(msg));
                    updateLog(`[Web] -> Enviado input: ${key}`);
                } else {
                    updateLog("Socket não está aberto. Input ignorado.");
                }
            }

            // Envia comando para limpar logs
            function sendClearLogs() {
                if (socket.readyState === WebSocket.OPEN) {
                    const msg = {
                        type: "clear_logs"
                    };
                    socket.send(JSON.stringify(msg));
                    updateLog("[Web] -> Solicitado limpeza de logs.");
                    // Limpa também a tela local
                    logDisplay.textContent = "";
                }
            }

            // --- 5. Event Listeners ---
            btnW.addEventListener("click", () => sendInput("w"));
            btnA.addEventListener("click", () => sendInput("a"));
            btnS.addEventListener("click", () => sendInput("s"));
            btnD.addEventListener("click", () => sendInput("d"));
            btnClearLogs.addEventListener("click", sendClearLogs);

            // --- 6. Funções de Atualização da UI ---
            
            // Adiciona uma mensagem ao box de logs
            function updateLog(message) {
                logDisplay.textContent += message + "\n";
                // Auto-scroll para o final
                logDisplay.scrollTop = logDisplay.scrollHeight;
            }

            // Atualiza o box de output (o donut)
            function updateOutput(frameData) {
                // O \x1b[H do seu donut C++ vai funcionar aqui!
                // Mas para garantir, limpamos o conteúdo antes.
                // O "frameData" deve conter o \x1b[H.
                outputDisplay.textContent = frameData;
            }
        });
    </script>
    </body>
</html>

